<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Wheel Segments</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div style="display: flex; justify-content: center; align-items: center; min-height: 100vh; background: #f8f9fa;">
        <div class="roulette-wheel" id="testWheel" style="position: relative;">
            <div class="wheel-center">
                <button id="testButton" class="spin-button">TEST</button>
            </div>
            <div class="wheel-pointer"></div>
        </div>
    </div>

    <script>
        // Minimal test for segment creation
        const catImages = [
            { id: 1, filename: "cat1.svg", alt: "Test cat 1" },
            { id: 2, filename: "cat2.svg", alt: "Test cat 2" },
            { id: 3, filename: "cat3.svg", alt: "Test cat 3" },
            { id: 4, filename: "cat4.svg", alt: "Test cat 4" }
        ];

        class WheelSegmentCreator {
            constructor(wheelElement) {
                this.wheelElement = wheelElement;
                this.segments = [];
            }

            createSegments(catImages) {
                try {
                    this.clearSegments();
                    
                    if (!catImages || catImages.length === 0) {
                        console.warn('No cat images provided for segment creation');
                        return [];
                    }

                    const totalCats = catImages.length;
                    const segmentAngle = 360 / totalCats;
                    
                    console.log(`Creating ${totalCats} wheel segments`);

                    catImages.forEach((cat, index) => {
                        try {
                            const segment = this.createSingleSegment(cat, index, totalCats, segmentAngle);
                            if (segment) {
                                this.segments.push(segment);
                                this.wheelElement.appendChild(segment);
                            }
                        } catch (error) {
                            console.error(`Error creating segment for cat ${cat.id}:`, error);
                        }
                    });

                    console.log(`Successfully created ${this.segments.length} wheel segments`);
                    return this.segments;

                } catch (error) {
                    console.error('Error in createSegments:', error);
                    return [];
                }
            }

            createSingleSegment(cat, index, totalCats, segmentAngle) {
                try {
                    const segment = document.createElement('div');
                    segment.className = 'wheel-segment';
                    segment.setAttribute('data-cat-id', cat.id);
                    segment.setAttribute('data-segment-index', index);

                    this.positionSegment(segment, index, segmentAngle);
                    this.applySegmentClipping(segment, segmentAngle);

                    const imageContainer = document.createElement('div');
                    imageContainer.className = 'segment-image-container';
                    imageContainer.innerHTML = `<div class="segment-placeholder">üê±</div>`;
                    segment.appendChild(imageContainer);

                    return segment;

                } catch (error) {
                    console.error(`Error creating single segment for cat ${cat.id}:`, error);
                    return null;
                }
            }

            positionSegment(segment, index, segmentAngle) {
                try {
                    const rotation = index * segmentAngle;
                    segment.style.transform = `rotate(${rotation}deg)`;
                    segment.style.transformOrigin = '50% 50%';
                    segment.setAttribute('data-rotation', rotation);
                } catch (error) {
                    console.error(`Error positioning segment ${index}:`, error);
                }
            }

            applySegmentClipping(segment, segmentAngle) {
                try {
                    const halfAngle = segmentAngle / 2;
                    const radians = (halfAngle * Math.PI) / 180;
                    
                    const x1 = 50 + (50 * Math.sin(-radians));
                    const y1 = 50 - (50 * Math.cos(-radians));
                    const x2 = 50 + (50 * Math.sin(radians));
                    const y2 = 50 - (50 * Math.cos(radians));

                    const clipPath = `polygon(50% 50%, ${x1}% ${y1}%, ${x2}% ${y2}%)`;
                    segment.style.clipPath = clipPath;

                } catch (error) {
                    console.error('Error applying segment clipping:', error);
                    segment.style.clipPath = 'polygon(50% 50%, 50% 0%, 100% 50%)';
                }
            }

            clearSegments() {
                try {
                    this.segments.forEach(segment => {
                        if (segment && segment.parentNode) {
                            segment.parentNode.removeChild(segment);
                        }
                    });
                    
                    this.segments = [];

                    const existingSegments = this.wheelElement.querySelectorAll('.wheel-segment');
                    existingSegments.forEach(segment => {
                        if (segment.parentNode) {
                            segment.parentNode.removeChild(segment);
                        }
                    });

                } catch (error) {
                    console.error('Error clearing segments:', error);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const testWheel = document.getElementById('testWheel');
            const testButton = document.getElementById('testButton');
            
            if (testWheel && testButton) {
                const segmentCreator = new WheelSegmentCreator(testWheel);
                
                testButton.addEventListener('click', function() {
                    console.log('Creating test segments...');
                    const segments = segmentCreator.createSegments(catImages);
                    console.log('Created segments:', segments.length);
                    
                    // Test rotation
                    testWheel.style.transition = 'transform 2s ease-out';
                    testWheel.style.transform = 'rotate(720deg)';
                });
                
                console.log('Test ready - click the TEST button to create segments');
            }
        });
    </script>
</body>
</html>